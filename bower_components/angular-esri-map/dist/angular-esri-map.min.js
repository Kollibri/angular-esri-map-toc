!function(e){"use strict";e.module("esri.map",[]),e.module("esri.map").factory("esriLoader",["$q",function(t){function i(i){var r=t.defer();e.isDefined(window.esri)&&r.reject("ESRI API is already loaded."),i=e.isDefined(i)?i:{};var n=document.createElement("script");return n.type="text/javascript",n.src=i.url||"http://js.arcgis.com/3.14compact",n.onload=function(){r.resolve(window.esri)},document.body.appendChild(n),r.promise}function r(){return e.isDefined(window.esri)}function n(i,n){var a=t.defer();return r()?(e.isString(i)?require([i],function(t){n&&e.isFunction(n)&&n(t),a.resolve(t)}):e.isArray(i)?require(i,function(){var t=Array.prototype.slice.call(arguments);n&&e.isFunction(n)&&n.apply(this,t),a.resolve(t)}):a.reject("An Array<String> or String is required to load modules."),a.promise):(a.reject("Trying to call esriLoader.require(), but esri API has not been loaded yet. Run esriLoader.bootstrap() if you are lazy loading esri ArcGIS API."),a.promise)}return{bootstrap:i,isLoaded:r,require:n}}])}(angular),function(e){"use strict";e.module("esri.map").service("esriRegistry",["$q",function(e){var t={};return{_register:function(i,r){t[i]||(t[i]=e.defer());var n=t[i];return r.promise.then(function(e){return n.resolve(e),e},function(e){return n.reject(e),e}),function(){delete t[i]}},get:function(i){if(t[i])return t[i].promise;var r=e.defer();return t[i]=r,r.promise}}}])}(angular),function(e){"use strict";e.module("esri.map").factory("esriMapUtils",function(){function e(e){return e===!0||"true"===e}var t={};return t.initLayerDirecive=function(t,i,r,n){var a="FeatureLayer"===r.layerType?0:void 0;return r.getLayer().then(function(r){return n.addLayer(r,a),n.addLayerInfo({title:i.title||r.name,layer:r,hideLayers:i.hideLayers?i.hideLayers.split(","):void 0,defaultSymbol:i.defaultSymbol?JSON.parse(i.defaultSymbol):!0}),t.$watch("visible",function(t,i){t!==i&&r.setVisibility(e(t))}),t.$watch("opacity",function(e,t){e!==t&&r.setOpacity(Number(e))}),i.load&&(r.loaded?t.load()(r):r.on("load",function(){t.$apply(function(){t.load()(r)})})),i.updateEnd&&r.on("update-end",function(e){t.$apply(function(){t.updateEnd()(e)})}),t.$on("$destroy",function(){n.removeLayer(r)}),r})},t})}(angular),function(e){"use strict";e.module("esri.map").directive("esriMap",["$q","$timeout","esriRegistry",function(t,i,r){function n(e,t){var i=t.geographicExtent&&t.geographicExtent.getCenter();i&&(i=i.normalize(),e.center={lat:i.y,lng:i.x}),e.zoom=t.getZoom()}return{restrict:"E",scope:{center:"=?",zoom:"=?",itemInfo:"=?",basemap:"@",load:"&",extentChange:"&",mapOptions:"&"},compile:function(e,t){return e.removeAttr("id"),e.append("<div id="+t.id+"></div>"),function(){}},controller:["$scope","$element","$attrs",function(a,o,s){var c=this,l=t.defer();if(s.registerAs){var u=r._register(s.registerAs,l);a.$on("$destroy",u)}require(["esri/map","esri/arcgis/utils","esri/geometry/Extent","esri/dijit/Popup"],function(t,r,o,u){var f=a.mapOptions()||{};if(f.hasOwnProperty("extent")&&"esri.geometry.Extent"!==f.extent.declaredClass&&(f.extent=new o(f.extent)),f.hasOwnProperty("infoWindow")&&f.infoWindow.hasOwnProperty("srcNodeRef")&&(f.infoWindow=new u(f.infoWindow.options||{},f.infoWindow.srcNodeRef)),a.basemap&&(f.basemap=a.basemap),a.center&&(f.center=a.center.lng&&a.center.lat?[a.center.lng,a.center.lat]:a.center),a.zoom&&(f.zoom=a.zoom),s.webmapId)r.createMap(s.webmapId,s.id,{mapOptions:f}).then(function(e){c.layerInfos=r.getLegendLayers(e),a.itemInfo=e.itemInfo,l.resolve(e.map)});else{var p=new t(s.id,f);l.resolve(p)}l.promise.then(function(t){t.loaded?(n(a,t),s.load&&a.load()(t)):s.load&&t.on("load",function(){a.$apply(function(){a.load()(t)})}),a.$watch("basemap",function(e,i){t.loaded&&e!==i&&t.setBasemap(e)}),a.inUpdateCycle=!1,e.isUndefined(a.center)&&e.isUndefined(a.zoom)||a.$watchGroup(["center.lng","center.lat","zoom"],function(e){a.inUpdateCycle||""!==e[0]&&""!==e[1]&&""!==e[2]&&(a.inUpdateCycle=!0,t.centerAndZoom([e[0],e[1]],e[2]).then(function(){a.inUpdateCycle=!1}))}),t.on("extent-change",function(e){s.extentChange&&a.extentChange()(e),a.inUpdateCycle||(a.inUpdateCycle=!0,a.$apply(function(){n(a,t),i(function(){a.inUpdateCycle=!1},0)}))}),a.$on("$destroy",function(){t.destroy()})})}),this.getMap=function(){return l.promise},this.addLayer=function(e,t){return this.getMap().then(function(i){return i.addLayer(e,t)})},this.removeLayer=function(e){return this.getMap().then(function(t){return t.removeLayer(e)})},this.addLayerInfo=function(e){this.layerInfos?this.layerInfos.unshift(e):this.layerInfos=[e]},this.getLayerInfos=function(){return this.layerInfos}}]}}])}(angular),function(e){"use strict";function t(e){return e===!0||"true"===e}e.module("esri.map").directive("esriFeatureLayer",["$q","esriMapUtils",function(i,r){return{restrict:"E",require:["esriFeatureLayer","^esriMap"],replace:!0,scope:{url:"@",visible:"@?",opacity:"@?",definitionExpression:"@?",load:"&",updateEnd:"&",layerOptions:"&"},controller:["$scope",function(r){var n=this,a=i.defer();this.layerType="FeatureLayer",require(["esri/layers/FeatureLayer","esri/InfoTemplate"],function(i,o){function s(t){return"esri.InfoTemplate"===t.declaredClass?t:e.isArray(t)&&2===t.length?new o(t[0],t[1]):new o(t.title,t.content)}var c=r.layerOptions()||{};e.isDefined(r.visible)&&(c.visible=t(r.visible)),r.opacity&&(c.opacity=Number(r.opacity)),r.definitionExpression&&(c.definitionExpression=r.definitionExpression),c.hasOwnProperty("infoTemplate")&&n.setInfoTemplate(c.infoTemplate),n._infoTemplate&&(n._infoTemplate=s(n._infoTemplate),c.infoTemplate=n._infoTemplate),c.hasOwnProperty("mode")&&(c.mode=i[c.mode]);var l=new i(r.url,c);a.resolve(l)}),this.getLayer=function(){return a.promise},this.setInfoTemplate=function(e){this._infoTemplate=e}}],link:function(e,t,i,n){var a=n[0],o=n[1];r.initLayerDirecive(e,i,a,o).then(function(t){e.$watch("definitionExpression",function(e,i){e!==i&&t.setDefinitionExpression(e)})})}}}])}(angular),function(e){"use strict";function t(e){return e===!0||"true"===e}function i(e){var t;return"string"==typeof e&&(t=[],e.split(",").forEach(function(e){var i=parseInt(e);isNaN(i)||t.push(i)})),t}e.module("esri.map").directive("esriDynamicMapServiceLayer",["$q","esriMapUtils",function(r,n){return{restrict:"E",require:["esriDynamicMapServiceLayer","^esriMap"],replace:!0,scope:{url:"@",visible:"@?",opacity:"@?",visibleLayers:"@?",load:"&",updateEnd:"&",layerOptions:"&"},controller:["$scope","$element","$attrs",function(n,a,o){var s=this,c=r.defer();this.layerType="ArcGISDynamicMapServiceLayer",this.setInfoTemplate=function(t,i){e.isObject(this._infoTemplates)||(this._infoTemplates={}),this._infoTemplates[t]={infoTemplate:i}},require(["esri/layers/ArcGISDynamicMapServiceLayer","esri/InfoTemplate","esri/layers/ImageParameters"],function(r,a,l){function u(t){return"esri.InfoTemplate"===t.declaredClass?t:e.isArray(t)&&2===t.length?new a(t[0],t[1]):new a(t.title,t.content)}var f=n.layerOptions()||{};if(e.isDefined(n.visible)&&(f.visible=t(n.visible)),n.opacity&&(f.opacity=Number(n.opacity)),e.isObject(f.infoTemplates))for(var p in f.infoTemplates)f.infoTemplates.hasOwnProperty(p)&&s.setInfoTemplate(p,f.infoTemplates[p].infoTemplate);if(s._infoTemplates){for(var d in s._infoTemplates)s._infoTemplates.hasOwnProperty(d)&&(s._infoTemplates[d].infoTemplate=u(s._infoTemplates[d].infoTemplate));f.infoTemplates=s._infoTemplates}if(e.isObject(f.imageParameters)&&"esri.layers.ImageParameters"!==f.imageParameters.declaredClass){var m=new l;for(var y in f.imageParameters)f.imageParameters.hasOwnProperty(y)&&(m[y]=f.imageParameters[y]);f.imageParameters=m}var v=new r(o.url,f);n.visibleLayers&&v.setVisibleLayers(i(n.visibleLayers)),c.resolve(v)}),this.getLayer=function(){return c.promise},s.setInfoTemplate=function(t,i){e.isObject(this._infoTemplates)||(this._infoTemplates={}),this._infoTemplates[t]={infoTemplate:i}}}],link:function(e,t,i,r){var a=r[0],o=r[1];n.initLayerDirecive(e,i,a,o)}}}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriInfoTemplate",function(){return{restrict:"E",require:["?esriInfoTemplate","?^esriDynamicMapServiceLayer","?^esriFeatureLayer"],replace:!0,compile:function(e){var t=e.html();return e.html(""),function(e,i,r,n){var a=n[1],o=n[2];a&&a.setInfoTemplate(r.layerId,{title:r.title,content:t}),o&&o.setInfoTemplate({title:r.title,content:t})}}}})}(angular),function(e){"use strict";e.module("esri.map").directive("esriLegend",["$document","$q",function(e,t){return{priority:-10,scope:{},replace:!0,require:["^esriMap"],link:function(e,i,r,n){var a=n[0],o=r.targetId||r.id,s=t.defer();require(["esri/dijit/Legend","dijit/registry"],function(t,i){a.getMap().then(function(r){var n={map:r},c=a.getLayerInfos();c&&(n.layerInfos=c);var l=i.byId(o);l&&l.destroyRecursive(),l=new t(n,o),l.startup(),e.$watchCollection(function(){return a.getLayerInfos()},function(e){l.refresh(e)}),s.resolve(l)})})}}}])}(angular);